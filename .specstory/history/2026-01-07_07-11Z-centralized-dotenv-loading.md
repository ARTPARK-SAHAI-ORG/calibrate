<!-- Generated by SpecStory, Markdown v2.1.0 -->

<!-- cursor Session ae0f6949-b846-4c3d-95a7-ccf4c0f3ae70 (2026-01-07 07:11Z) -->

# Centralized dotenv loading (2026-01-07 07:11Z)

_**User (2026-01-07 03:35Z)**_

dotenv is being used repeatedly in different files for loading env vars - make sure that when called from cli it loads env var so that each of the modules don't have to

---

_**Agent (model composer-1, mode Agent)**_



---


Checking where `dotenv` is used and how the CLI is structured.


---

<tool-use data-tool-type="search" data-tool-name="grep">
<details>
<summary>Tool use: **grep** • Grep for "dotenv|load_dotenv" • 32 matches</summary>

Output mode: content


| File | Content | Line |
|------|------|------|
| `./pyproject.toml` | `"python-dotenv>=1.2.1",` | L23 |
| `./uv.lock` | `\{ name = "python-dotenv" \},` | L3220 |
| `./uv.lock` | `\{ name = "python-dotenv", specifier = ">=1.2.1" \},` | L3247 |
| `./uv.lock` | `\{ name = "python-dotenv" \},` | L3879 |
| `./uv.lock` | `name = "python-dotenv"` | L3998 |
| `./uv.lock` | `sdist = \{ url = "https://files.pythonhosted.org/packages/f0/26/19cadc79a718c5edbec86fd4919a6b6d3f681039a2f6d66d14be94e75fb9/python_dotenv-1.2.1.tar.gz", hash = "sha256:42667e897e16ab0d66954af0e60a9caa94f0fd4ecf3aaf6d2d260eec1aa36ad6", size = 44221, upload-time = "2025-10-26T15:12:10.434Z" \}` | L4001 |
| `./uv.lock` | `\{ url = "https://files.pythonhosted.org/packages/14/1b/a298b06749107c305e1fe0f814c6c74aea7b2f1e10989cb30f544a1b3253/python_dotenv-1.2.1-py3-none-any.whl", hash = "sha256:b81ee9561e9ca4004139c6cbba3a238c32b03e4894671e181b671e8cb8425d61", size = 21230, upload-time = "2025-10-26T15:12:09.109Z" \},` | L4003 |
| `./uv.lock` | `\{ name = "python-dotenv" \},` | L5117 |
| `./pense/agent/test.py` | `from dotenv import load_dotenv` | L8 |
| `./pense/agent/test.py` | `load_dotenv(override=True)` | L69 |
| `./pense/agent/bot.py` | `from dotenv import load_dotenv` | L4 |
| `./pense/agent/bot.py` | `load_dotenv(override=True)` | L95 |
| `./pense/agent/run_simulation.py` | `from dotenv import load_dotenv` | L104 |
| `./pense/agent/run_simulation.py` | `load_dotenv(override=True)` | L107 |
| `./pense/llm/run_simulation.py` | `from dotenv import load_dotenv` | L7 |
| `./pense/llm/run_simulation.py` | `load_dotenv(override=True)` | L44 |
| `./pense/llm/run_tests.py` | `from dotenv import load_dotenv` | L6 |
| `./pense/llm/run_tests.py` | `load_dotenv(override=True)` | L40 |
| `./pense/tts/eval.py` | `from dotenv import load_dotenv` | L89 |
| `./pense/tts/eval.py` | `load_dotenv(override=True)` | L91 |
| `./pense/stt/eval.py` | `from dotenv import load_dotenv` | L13 |
| `./pense/stt/eval.py` | `load_dotenv(override=True)` | L81 |
| `./pense/stt/metrics.py` | `from dotenv import load_dotenv` | L8 |
| `./pense/stt/metrics.py` | `load_dotenv(override=True)` | L12 |
| `./pense/llm/metrics.py` | `from dotenv import load_dotenv` | L5 |
| `./pense/llm/metrics.py` | `load_dotenv()` | L10 |
| `./pense/stt/eval_smallest.py` | `from dotenv import load_dotenv` | L9 |
| `./pense/stt/eval_smallest.py` | `load_dotenv(override=True)` | L14 |
| `./pense/tts/metrics.py` | `from dotenv import load_dotenv` | L9 |
| `./pense/tts/metrics.py` | `load_dotenv(override=True)` | L14 |
| `./pense/tts/test_smallest.py` | `from dotenv import load_dotenv` | L3 |
| `./pense/tts/test_smallest.py` | `load_dotenv(override=True)` | L6 |


</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /Users/aman/Documents/repos/artpark/agentloop/pense/cli.py</summary>

</details>
</tool-use>

---



---


Checking a few files to understand how dotenv is used:


---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /Users/aman/Documents/repos/artpark/agentloop/pense/llm/run_tests.py</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /Users/aman/Documents/repos/artpark/agentloop/pense/agent/bot.py</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /Users/aman/Documents/repos/artpark/agentloop/pense/stt/eval.py</summary>

</details>
</tool-use>

---



---


Centralizing dotenv loading in the CLI entry point and removing it from individual modules. Creating a todo list and starting:


---

<tool-use data-tool-type="task" data-tool-name="todo_write">
<details><summary>Tool use: **todo_write** • Todo List</summary>

- [-] Add dotenv loading to CLI main() function
- [ ] Remove dotenv loading from all individual modules

</details>
</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: /Users/aman/Documents/repos/artpark/agentloop/pense/cli.py</summary>

**Chunk 1**
Lines added: 1, lines removed: undefined

```diff
@@ -20,4 +20,5 @@
  import runpy
  import os
+ from dotenv import load_dotenv
  
  
```

</details>

</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: /Users/aman/Documents/repos/artpark/agentloop/pense/cli.py</summary>

**Chunk 1**
Lines added: 3, lines removed: undefined

```diff
@@ -58,4 +58,7 @@
  def main():
      """Main CLI entry point that dispatches to component-specific scripts."""
+     # Load environment variables from .env file
+     load_dotenv(override=True)
+     
      parser = argparse.ArgumentParser(
          prog="pense",
```

</details>

</tool-use>

---



---


Removing dotenv loading from all individual modules:


---

<tool-use data-tool-type="task" data-tool-name="todo_write">
<details><summary>Tool use: **todo_write** • Todo List</summary>

- [x] Add dotenv loading to CLI main() function
- [-] Remove dotenv loading from all individual modules

</details>
</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: /Users/aman/Documents/repos/artpark/agentloop/pense/llm/run_tests.py</summary>

**Chunk 1**
Lines added: undefined, lines removed: 1

```diff
@@ -4,5 +4,4 @@
  from typing import List
  from loguru import logger
- from dotenv import load_dotenv
  import os
  from os.path import join, exists, splitext, basename
```

</details>

</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: /Users/aman/Documents/repos/artpark/agentloop/pense/llm/run_tests.py</summary>

**Chunk 1**
Lines added: undefined, lines removed: 2

```diff
@@ -36,6 +36,4 @@
  from pipecat.observers.loggers.llm_log_observer import LLMLogObserver
  from pense.llm.metrics import test_response_llm_judge
- 
- load_dotenv(override=True)
  
  
```

</details>

</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: /Users/aman/Documents/repos/artpark/agentloop/pense/agent/bot.py</summary>

**Chunk 1**
Lines added: undefined, lines removed: 1

```diff
@@ -2,5 +2,4 @@
  from typing import Dict, Literal
  
- from dotenv import load_dotenv
  from loguru import logger
  import asyncio
```

</details>

</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: /Users/aman/Documents/repos/artpark/agentloop/pense/agent/bot.py</summary>

**Chunk 1**
Lines added: undefined, lines removed: 2

```diff
@@ -91,6 +91,4 @@
  
  bot_logger = logger.bind(source="BOT")
- 
- load_dotenv(override=True)
  
  
```

</details>

</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /Users/aman/Documents/repos/artpark/agentloop/pense/agent/run_simulation.py</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /Users/aman/Documents/repos/artpark/agentloop/pense/llm/run_simulation.py</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /Users/aman/Documents/repos/artpark/agentloop/pense/tts/eval.py</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /Users/aman/Documents/repos/artpark/agentloop/pense/stt/metrics.py</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /Users/aman/Documents/repos/artpark/agentloop/pense/llm/metrics.py</summary>

</details>
</tool-use>

---



---


Removing dotenv from the remaining files:


---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: /Users/aman/Documents/repos/artpark/agentloop/pense/agent/run_simulation.py</summary>

**Chunk 1**
Lines added: undefined, lines removed: 3

```diff
@@ -102,8 +102,5 @@
  from pipecat.serializers.protobuf import ProtobufFrameSerializer
  from pense.agent.bot import run_bot, STTConfig, TTSConfig, LLMConfig
- from dotenv import load_dotenv
  from pipecat.utils.time import time_now_iso8601
- 
- load_dotenv(override=True)
  
  
```

</details>

</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: /Users/aman/Documents/repos/artpark/agentloop/pense/llm/run_simulation.py</summary>

**Chunk 1**
Lines added: undefined, lines removed: 1

```diff
@@ -5,5 +5,4 @@
  from typing import List, Optional, Literal
  from loguru import logger
- from dotenv import load_dotenv
  import os
  from os.path import join, exists, splitext, basename
```

</details>

</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: /Users/aman/Documents/repos/artpark/agentloop/pense/llm/run_simulation.py</summary>

**Chunk 1**
Lines added: undefined, lines removed: 2

```diff
@@ -40,6 +40,4 @@
  import pandas as pd
  import numpy as np
- 
- load_dotenv(override=True)
  
  
```

</details>

</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: /Users/aman/Documents/repos/artpark/agentloop/pense/tts/eval.py</summary>

**Chunk 1**
Lines added: undefined, lines removed: 3

```diff
@@ -87,7 +87,4 @@
  from pipecat.processors.transcript_processor import TranscriptProcessor
  from pense.tts.metrics import get_tts_llm_judge_score
- from dotenv import load_dotenv
- 
- load_dotenv(override=True)
  
  WAIT_TIME_BETWEEN_TURNS = 5
```

</details>

</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: /Users/aman/Documents/repos/artpark/agentloop/pense/stt/eval.py</summary>

**Chunk 1**
Lines added: undefined, lines removed: 1

```diff
@@ -11,5 +11,4 @@
  from typing import Dict, List, Sequence, Literal, Optional
  
- from dotenv import load_dotenv
  from collections import defaultdict
  from loguru import logger
```

</details>

</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: /Users/aman/Documents/repos/artpark/agentloop/pense/stt/eval.py</summary>

**Chunk 1**
Lines added: undefined, lines removed: 2

```diff
@@ -77,6 +77,4 @@
  )
  import pandas as pd
- 
- load_dotenv(override=True)
  
  
```

</details>

</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: /Users/aman/Documents/repos/artpark/agentloop/pense/stt/metrics.py</summary>

**Chunk 1**
Lines added: undefined, lines removed: 3

```diff
@@ -6,9 +6,6 @@
  import difflib
  from openai import AsyncOpenAI
- from dotenv import load_dotenv
  from pydantic import BaseModel, Field
  import backoff
- 
- load_dotenv(override=True)
  
  normalizer = BasicTextNormalizer()
```

</details>

</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: /Users/aman/Documents/repos/artpark/agentloop/pense/llm/metrics.py</summary>

**Chunk 1**
Lines added: undefined, lines removed: 3

```diff
@@ -3,10 +3,7 @@
  from pydantic import BaseModel, Field
  from typing import List
- from dotenv import load_dotenv
  import os
  from pydantic import BaseModel, Field, create_model
  import json
- 
- load_dotenv()
  
  
```

</details>

</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /Users/aman/Documents/repos/artpark/agentloop/pense/agent/test.py</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /Users/aman/Documents/repos/artpark/agentloop/pense/stt/eval_smallest.py</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /Users/aman/Documents/repos/artpark/agentloop/pense/tts/metrics.py</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /Users/aman/Documents/repos/artpark/agentloop/pense/tts/test_smallest.py</summary>

</details>
</tool-use>

---



---


Removing dotenv from the remaining files:


---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: /Users/aman/Documents/repos/artpark/agentloop/pense/agent/test.py</summary>

**Chunk 1**
Lines added: undefined, lines removed: 1

```diff
@@ -6,5 +6,4 @@
  import json
  from os.path import join, exists
- from dotenv import load_dotenv
  from loguru import logger
  import shutil
```

</details>

</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: /Users/aman/Documents/repos/artpark/agentloop/pense/agent/test.py</summary>

**Chunk 1**
Lines added: undefined, lines removed: 2

```diff
@@ -65,6 +65,4 @@
  from pipecat.observers.loggers.llm_log_observer import LLMLogObserver
  
- 
- load_dotenv(override=True)
  
  CUSTOM_CLI_ARGS: dict[str, Any] = {}
```

</details>

</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: /Users/aman/Documents/repos/artpark/agentloop/pense/stt/eval_smallest.py</summary>

**Chunk 1**
Lines added: undefined, lines removed: 3

```diff
@@ -7,10 +7,7 @@
  from whisper_normalizer.basic import BasicTextNormalizer
  from jiwer import wer
- from dotenv import load_dotenv
  import os
  from os.path import join, exists
  from loguru import logger
- 
- load_dotenv(override=True)
  
  english_normalizer = EnglishTextNormalizer()
```

</details>

</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: /Users/aman/Documents/repos/artpark/agentloop/pense/tts/metrics.py</summary>

**Chunk 1**
Lines added: undefined, lines removed: 3

```diff
@@ -7,10 +7,7 @@
  import json
  from openai import AsyncOpenAI
- from dotenv import load_dotenv
  from pydantic import BaseModel, Field
  import base64
  import backoff
- 
- load_dotenv(override=True)
  
  normalizer = BasicTextNormalizer()
```

</details>

</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: /Users/aman/Documents/repos/artpark/agentloop/pense/tts/test_smallest.py</summary>

**Chunk 1**
Lines added: undefined, lines removed: 3

```diff
@@ -1,8 +1,5 @@
  import time
  from smallestai.waves import TTSConfig, WavesStreamingTTS
- from dotenv import load_dotenv
  import os
- 
- load_dotenv(override=True)
  
  config = TTSConfig(
```

</details>

</tool-use>

---

<tool-use data-tool-type="task" data-tool-name="todo_write">
<details><summary>Tool use: **todo_write** • Todo List</summary>

- [x] Add dotenv loading to CLI main() function
- [x] Remove dotenv loading from all individual modules

</details>
</tool-use>

---



---


Verifying all dotenv imports and calls are removed, and checking for linting errors:


---

<tool-use data-tool-type="search" data-tool-name="grep">
<details>
<summary>Tool use: **grep** • Grep for "load_dotenv|from dotenv" in "pense" • 2 matches</summary>

Output mode: content


| File | Content | Line |
|------|------|------|
| `pense/cli.py` | `from dotenv import load_dotenv` | L22 |
| `pense/cli.py` | `load_dotenv(override=True)` | L61 |


</details>
</tool-use>

---

<tool-use data-tool-type="generic" data-tool-name="read_lints">
<details>
          <summary>Tool use: **read_lints** • Read lints for 1 file</summary>
      
Lint paths:

- `pense/cli.py`

Lint results


**No lint errors found**
</details>
</tool-use>

---



---


Verifying the CLI file looks correct:


---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /Users/aman/Documents/repos/artpark/agentloop/pense/cli.py</summary>

</details>
</tool-use>

---



---


Centralized dotenv loading in the CLI entry point.

## Summary

1. **Added dotenv loading to CLI** (`pense/cli.py`):
   - Imported `load_dotenv` from `dotenv`
   - Added `load_dotenv(override=True)` at the start of the `main()` function

2. **Removed dotenv loading from all individual modules**:
   - `pense/llm/run_tests.py`
   - `pense/llm/run_simulation.py`
   - `pense/llm/metrics.py`
   - `pense/agent/bot.py`
   - `pense/agent/run_simulation.py`
   - `pense/agent/test.py`
   - `pense/stt/eval.py`
   - `pense/stt/eval_smallest.py`
   - `pense/stt/metrics.py`
   - `pense/tts/eval.py`
   - `pense/tts/metrics.py`
   - `pense/tts/test_smallest.py`

When the CLI is invoked, environment variables are loaded once at the start, so individual modules no longer need to load them. This removes redundant calls and ensures consistent loading behavior across all CLI commands.

---

_**User (2026-01-07 03:35Z)**_

now if an external api server uses the library how should they set up the env vars so that this can work 

the external api server will use subprocess to invoke the cli

---

_**Agent (model composer-1, mode Agent)**_



---


Checking the current setup and how external API servers can pass environment variables when invoking the CLI via subprocess.


---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /Users/aman/Documents/repos/artpark/agentloop/pense/utils.py</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /Users/aman/Documents/repos/artpark/agentloop/pense/cli.py</summary>

</details>
</tool-use>

---



---


Updating dotenv loading to work better with subprocess invocation. Making it respect existing environment variables (set by the parent process) and allowing an optional .env file path via an environment variable.


---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /Users/aman/Documents/repos/artpark/agentloop/pense/cli.py</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="search" data-tool-name="codebase_search">
<details>
                <summary>Tool use: **codebase_search** • Searched codebase "How are environment variables used for API keys in the codebase?" • **14** results</summary>
            
| File | Lines |
|------|-------|
| `docs/getting-started/configuration.md` | L83 |
| `pense/agent/test.py` | L141-513 |
| `pense/agent/bot.py` | L127-560 |
| `README.md` | L767-802 |
| `docs/troubleshooting/api-keys.md` | L22 |
| `pense/stt/eval.py` | L77-238 |
| `pense/agent/bot.py` | L129-560 |
| `README.md` | L30 |
| `pense/agent/run_simulation.py` | L593-890 |
| `README.md` | L588-624 |
| `pense/llm/run_simulation.py` | L86-409 |
| `README.md` | L87-152 |
| `pense/tts/eval.py` | L87-335 |
| `README.md` | L443-509 |

</details>
</tool-use>

---



---


Updating the CLI to work better with subprocess invocation: existing environment variables take precedence, and we allow specifying a custom .env file path.


---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: /Users/aman/Documents/repos/artpark/agentloop/pense/cli.py</summary>

**Chunk 1**
Lines added: 9, lines removed: 1

```diff
@@ -59,5 +59,13 @@
      """Main CLI entry point that dispatches to component-specific scripts."""
      # Load environment variables from .env file
-     load_dotenv(override=True)
+     # Use override=False so that environment variables set by parent process (e.g., via subprocess)
+     # take precedence over .env file values. This allows external API servers to pass env vars
+     # explicitly when invoking the CLI via subprocess.
+     # Optionally specify custom .env file path via PENSE_ENV_FILE environment variable
+     env_file = os.getenv("PENSE_ENV_FILE")
+     if env_file:
+         load_dotenv(dotenv_path=env_file, override=False)
+     else:
+         load_dotenv(override=False)
  
      parser = argparse.ArgumentParser(
```

</details>

</tool-use>

---



---


Checking for linting errors and verifying the implementation:


---

<tool-use data-tool-type="generic" data-tool-name="read_lints">
<details>
          <summary>Tool use: **read_lints** • Read lints for 1 file</summary>
      
Lint paths:

- `pense/cli.py`

Lint results


**No lint errors found**
</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /Users/aman/Documents/repos/artpark/agentloop/pense/cli.py</summary>

</details>
</tool-use>

---



---


Updated the CLI to work better with subprocess invocation. Changes:

1. Changed `override=True` to `override=False` — environment variables set by the parent process take precedence over `.env` file values
2. Added support for custom `.env` file path via `PENSE_ENV_FILE` environment variable

## How External API Servers Should Set Up Environment Variables

When invoking the CLI via subprocess, you have three options:

### Option 1: Pass environment variables explicitly (Recommended)

Set environment variables in the subprocess call. These will take precedence over any `.env` file:

```python
import subprocess
import os

# Set up environment variables
env = os.environ.copy()
env.update({
    "OPENAI_API_KEY": "your_openai_key",
    "DEEPGRAM_API_KEY": "your_deepgram_key",
    "GOOGLE_APPLICATION_CREDENTIALS": "/path/to/credentials.json",
    # ... other required API keys
})

# Invoke CLI via subprocess
result = subprocess.run(
    ["pense", "stt", "eval", "-p", "deepgram", "-l", "english", "-i", "./data", "-o", "./out"],
    env=env,  # Pass the environment variables
    capture_output=True,
    text=True
)
```

### Option 2: Set environment variables in parent process

Set environment variables before invoking subprocess (they'll be inherited):

```python
import subprocess
import os

# Set environment variables in current process
os.environ["OPENAI_API_KEY"] = "your_openai_key"
os.environ["DEEPGRAM_API_KEY"] = "your_deepgram_key"
os.environ["GOOGLE_APPLICATION_CREDENTIALS"] = "/path/to/credentials.json"

# Invoke CLI - env vars will be inherited
result = subprocess.run(
    ["pense", "stt", "eval", "-p", "deepgram", "-l", "english", "-i", "./data", "-o", "./out"],
    capture_output=True,
    text=True
)
```

### Option 3: Use a custom .env file path

If you want to use a `.env` file in a specific location:

```python
import subprocess
import os

# Specify custom .env file location
env = os.environ.copy()
env["PENSE_ENV_FILE"] = "/path/to/your/custom/.env"

result = subprocess.run(
    ["pense", "stt", "eval", "-p", "deepgram", "-l", "english", "-i", "./data", "-o", "./out"],
    env=env,
    capture_output=True,
    text=True
)
```

## Priority Order

Environment variables are loaded in this priority order (highest to lowest):
1. Environment variables explicitly passed to subprocess (`env` parameter)
2. Environment variables inherited from parent process
3. Values from `.env` file (only fills in missing variables)

This ensures that when an external API server sets environment variables, they take precedence over any `.env` file, which is the expected behavior for subprocess invocation.

---

